{%- comment -%}
Gallery include
Usage:
  {% include gallery.html project=page %}
  or (when included from a project layout) you can omit parameter
{%- endcomment -%}

{%- assign the_project = include.project | default: page -%}
{%- assign prefix = '/assets/projects/' | append: the_project.slug | append: '/' -%}

<div class="gallery">
  {%- assign imgs = site.static_files | where_exp: "f", "f.path contains prefix" -%}
  {%- assign sorted_imgs = imgs | sort: "path" -%}
  {%- for file in sorted_imgs -%}
    <div class="gallery-item">
      <a href="{{ file.path | relative_url }}" target="_blank" rel="noopener">
        <img src="{{ file.path | relative_url }}?v={{ site.time | date: '%Y%m%d%H%M%S' }}" alt="{{ the_project.title }} - image {{ forloop.index }}">
      </a>
    </div>
  {%- endfor -%}

  {%- if sorted_imgs == empty -%}
    <p class="muted">No images found for {{ the_project.title }} (expected: {{ prefix }})</p>
  {%- endif -%}
</div>
