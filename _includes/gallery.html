{%- comment -%}
Gallery include (safe for GitHub Pages)
--------------------------------------
Assumes images are named:
  assets/projects/<slug>/screenshot-1.png
  assets/projects/<slug>/screenshot-2.png
  ...
Up to 20 images are attempted; missing ones auto-remove.

Usage in project page:
  {% include gallery.html slug="project-a" title="Project A" %}
{%- endcomment -%}

{%- assign project_slug = include.slug | default: page.slug | default: page.name | split: "." | first -%}
{%- assign project_path = '/assets/projects/' | append: project_slug -%}

<h2>Gallery</h2>
<div class="swiper gallery-swiper">
  <div class="swiper-wrapper">
    {%- for i in (1..20) -%}
      <div class="swiper-slide">
        <img src="{{ project_path }}/screenshot-{{ i }}.png"
             alt="{{ include.title | default: page.title }} screenshot {{ i }}"
             onerror="this.parentNode.remove();">
      </div>
    {%- endfor -%}
  </div>

  <div class="swiper-pagination"></div>
  <div class="swiper-button-prev" aria-label="Previous slide"></div>
  <div class="swiper-button-next" aria-label="Next slide"></div>
</div>

<!-- Swiper resources -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
<script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>

<script>
document.addEventListener("DOMContentLoaded", function () {
  const wrapperSelector = ".gallery-swiper";
  const wrapper = document.querySelector(wrapperSelector);
  if (!wrapper) return;

  setTimeout(() => {
    // Remove slides whose <img> failed to load
    wrapper.querySelectorAll(".swiper-slide").forEach(slide => {
      if (!slide.querySelector("img") || !slide.querySelector("img").src) slide.remove();
    });

    if (wrapper.querySelectorAll(".swiper-slide").length === 0) {
      const msg = document.createElement("p");
      msg.innerHTML = '<em>No gallery images found in <code>{{ project_path }}</code></em>';
      wrapper.parentNode.insertBefore(msg, wrapper);
      wrapper.remove();
      return;
    }

    new Swiper(wrapperSelector, {
      loop: true,
      pagination: { el: wrapperSelector + ' .swiper-pagination', clickable: true },
      navigation: { nextEl: wrapperSelector + ' .swiper-button-next', prevEl: wrapperSelector + ' .swiper-button-prev' },
      slidesPerView: 1,
      spaceBetween: 10
    });
  }, 200);
});
</script>
